<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making maps with cancensus â€¢ cancensus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Making maps with cancensus">
<meta property="og:description" content="cancensus">
<meta property="og:image" content="https://mountainmath.github.io/cancensus/logo.png">
<meta property="og:image:alt" content="cancensus">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:site" content="https://mountainmath.github.io/cancensus/">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107390160-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-107390160-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cancensus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cancensus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mountainMath/cancensus/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Making maps with cancensus</h1>
                        <h4 class="author">Dmitry Shkolnik</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mountainMath/cancensus/blob/master/vignettes/Making_maps_with_cancensus.Rmd"><code>vignettes/Making_maps_with_cancensus.Rmd</code></a></small>
      <div class="hidden name"><code>Making_maps_with_cancensus.Rmd</code></div>

    </div>

    
    
<div id="spatial-data-in-cancensus" class="section level1">
<h1 class="hasAnchor">
<a href="#spatial-data-in-cancensus" class="anchor"></a>Spatial data in cancensus</h1>
<p><strong>cancensus</strong> can retrieve spatial data either on its own or packaged together with Census data.</p>
<p>You can specify whether you want data returned in an <code>sf</code>-class data frame or as a <code>sp</code>-class SpatialPolygonsDataFrame object. There are advantages to each spatial format. The <code>sf</code> spatial framework is under development as the new principal spatial library for R and takes advantage of the <a href="https://en.wikipedia.org/wiki/Simple_Features">Simple Features</a> standard.</p>
<p>On the other hand, <code>sp</code> has been around for a long time with development starting in the early 2000s and, as a result, it is a robust and well-maintained package with a large ecosystem of specialized packages that rely on it. First released in October 2016, <code>sf</code> is a package still under development can be buggy and prone to breaking.</p>
<p><strong>cancensus</strong> retrieves Census geographic data as GeoJSON objects and then converts them into either <code>sp</code> or <code>sf</code> objects depending on the <code>geo_format</code> parameter input. The examples in this vignette assume <code>sf</code> class geography.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">cancensus</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)
<span class="co"># retrieve sf dataframe</span>
<span class="no">toronto</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_census.html">get_census</a></span>(<span class="kw">dataset</span><span class="kw">=</span><span class="st">'CA16'</span>, <span class="kw">regions</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">CMA</span><span class="kw">=</span><span class="st">"35535"</span>),
                         <span class="kw">vectors</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"median_hh_income"</span><span class="kw">=</span><span class="st">"v_CA16_2397"</span>), <span class="kw">level</span><span class="kw">=</span><span class="st">'CSD'</span>, <span class="kw">quiet</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                         <span class="kw">geo_format</span> <span class="kw">=</span> <span class="st">'sf'</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="st">'short'</span>)</pre></body></html></div>
</div>
<div id="maps-with-base-r-graphics" class="section level1">
<h1 class="hasAnchor">
<a href="#maps-with-base-r-graphics" class="anchor"></a>Maps with base R graphics</h1>
<p>The <code>sf</code> package provides a wrapper around the base R <code><a href="https://rdrr.io/pkg/sf/man/plot.html">plot()</a></code> function and largely works the same way with most of the same custom graphical parameters. One key thing about <code>sf.plot()</code> is that it will plot every column of a sf data frame separately unless you specify a particular column. In this case, the household income variable we selected is stored in the <code>v_CA16_2397</code> column. Plotting it is easy.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">toronto</span>[<span class="st">"median_hh_income"</span>], <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Toronto Household Income by CSD"</span>)</pre></body></html></div>
<p>You can specify titles, colour palettes, breaks, background colour, lines, borders, transparency, graticules, and much more by taking advantage of the available parameters. You can also combine layers of graphics objects made with <code><a href="https://rdrr.io/pkg/sf/man/plot.html">plot()</a></code> by running different plots and adding the <code>add = TRUE</code> parameter.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">toronto</span>), <span class="kw">col</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Toronto CSDs with Median HH Income &gt; $100,000"</span>, <span class="kw">lty</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">toronto</span>[<span class="no">toronto</span>$<span class="no">median_hh_income</span> <span class="kw">&gt;</span> <span class="fl">100000</span>,]), <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
<div id="maps-with-ggplot2" class="section level1">
<h1 class="hasAnchor">
<a href="#maps-with-ggplot2" class="anchor"></a>Maps with ggplot2</h1>
<p>Plotting <code>sf</code> objects with <code>ggplot2</code> is very straightforward with the built-in <code>geom_sf</code> layer in the latest version of <code>ggplot2</code>.</p>
<p><code>ggplot2</code> supports all types of simple features and can automatically read and align CRS across multiple layers, can automatically adjust aspect ratio, and will automatically draw a graticule for your map. The advantage of using <code>ggplot2</code> for static maps is the customization and flexibility offered by the <code>ggplot2</code> layer and geom system.</p>
<p>An example of a basic map.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">toronto</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">median_hh_income</span>))</pre></body></html></div>
<p>Or a similar map with all of the trimmings:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">toronto</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">median_hh_income</span>), <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"grey"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>(<span class="st">"Median HH Income"</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="no"><a href="https://scales.r-lib.org//reference/label_dollar.html">dollar</a></span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">panel.grid</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span>(<span class="kw">datum</span><span class="kw">=</span><span class="fl">NA</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Median Household Income"</span>, <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Toronto Census Subdivisions, 2016 Census"</span>)</pre></body></html></div>
</div>
<div id="interactive-maps-with-leaflet" class="section level1">
<h1 class="hasAnchor">
<a href="#interactive-maps-with-leaflet" class="anchor"></a>Interactive maps with leaflet</h1>
<p>The <a href="http://leafletjs.com">leaflet</a> library is a mainstay behind interactive web maps, and RStudio has <a href="https://rstudio.github.io/leaflet/">package</a> that allows creation of interactive leaflet maps without having to leave R or use Javascript.</p>
<p>Leaflet for R can natively read in <code>sf</code> or <code>sp</code> class objects. Leaflet maps use a tile layer server to generate the base maps on which your data is plotted. Thereâ€™s a number of different base layers available to use, although some require third party API keys. A gallery of available basemaps can be found <a href="http://leaflet-extras.github.io/leaflet-providers/preview/index.html">here</a>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">leaflet</span>)
<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span>(<span class="no">toronto</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span>(<span class="no">providers</span>$<span class="no">CartoDB.Positron</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span>()</pre></body></html></div>
<p>Adding colour ramps and additional interactivity takes a little bit more work but is still pretty easy to implement. Following this <a href="https://rstudio.github.io/leaflet/choropleths.html">example</a> we can specify the colour ramp to match our needs.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">bins</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">30000</span>,<span class="fl">40000</span>, <span class="fl">50000</span>,<span class="fl">60000</span>, <span class="fl">70000</span>,<span class="fl">80000</span>, <span class="fl">90000</span>,<span class="fl">100000</span>, <span class="fl">110000</span>, <span class="fl">Inf</span>)
<span class="no">pal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorBin</a></span>(<span class="st">"RdYlBu"</span>, <span class="kw">domain</span> <span class="kw">=</span> <span class="no">toronto</span>$<span class="no">v_CA16_2397</span>, <span class="kw">bins</span> <span class="kw">=</span> <span class="no">bins</span>)
<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span>(<span class="no">toronto</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span>(<span class="no">providers</span>$<span class="no">CartoDB.Positron</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span>(<span class="kw">fillColor</span> <span class="kw">=</span> ~<span class="fu">pal</span>(<span class="no">median_hh_income</span>),
              <span class="kw">color</span> <span class="kw">=</span> <span class="st">"white"</span>,
              <span class="kw">weight</span> <span class="kw">=</span> <span class="fl">1</span>,
              <span class="kw">opacity</span> <span class="kw">=</span> <span class="fl">1</span>,
              <span class="kw">fillOpacity</span> <span class="kw">=</span> <span class="fl">0.65</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mountainmath.ca">Jens von Bergmann</a>, <a href="https://dshkol.com">Dmitry Shkolnik</a>, Aaron Jacobs.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
